{"ast":null,"code":"import { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { FormControl, FormGroup, Validators, FormArray } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../main-service.service\";\nimport * as i3 from \"@angular/material/snack-bar\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/icon\";\n\nfunction PurchaseModelComponent_tbody_85_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"tbody\", 24)(1, \"tr\", 25)(2, \"th\", 26);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\")(5, \"input\", 27);\n    i0.ɵɵlistener(\"input\", function PurchaseModelComponent_tbody_85_Template_input_input_5_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const item_r2 = restoredCtx.$implicit;\n      const i_r3 = restoredCtx.index;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.arrayValChange(\"item\", item_r2.item, i_r3));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"td\")(7, \"input\", 28);\n    i0.ɵɵlistener(\"input\", function PurchaseModelComponent_tbody_85_Template_input_input_7_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const item_r2 = restoredCtx.$implicit;\n      const i_r3 = restoredCtx.index;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.arrayValChange(\"bag\", item_r2.bag, i_r3));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"td\")(9, \"input\", 29);\n    i0.ɵɵlistener(\"input\", function PurchaseModelComponent_tbody_85_Template_input_input_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const item_r2 = restoredCtx.$implicit;\n      const i_r3 = restoredCtx.index;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.arrayValChange(\"quantity\", item_r2.quantity, i_r3));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"td\")(11, \"input\", 30);\n    i0.ɵɵlistener(\"input\", function PurchaseModelComponent_tbody_85_Template_input_input_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const item_r2 = restoredCtx.$implicit;\n      const i_r3 = restoredCtx.index;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.arrayValChange(\"rate\", item_r2.rate, i_r3));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"td\");\n    i0.ɵɵelement(13, \"input\", 31);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"td\")(15, \"button\", 32);\n    i0.ɵɵlistener(\"click\", function PurchaseModelComponent_tbody_85_Template_button_click_15_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const i_r3 = restoredCtx.index;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.removeItem(i_r3));\n    });\n    i0.ɵɵelementStart(16, \"mat-icon\", 33);\n    i0.ɵɵtext(17, \"delete\");\n    i0.ɵɵelementEnd()()()()();\n  }\n\n  if (rf & 2) {\n    const item_r2 = ctx.$implicit;\n    const i_r3 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵpropertyInterpolate(\"formGroupName\", i_r3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r3 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"value\", item_r2.item_name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"value\", item_r2.bag);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"value\", item_r2.quantity);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"value\", item_r2.rate);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"value\", item_r2.quantity * item_r2.rate);\n  }\n}\n\nexport let PurchaseModelComponent = /*#__PURE__*/(() => {\n  class PurchaseModelComponent {\n    constructor(fb, mainService, data, _snackBar) {\n      this.fb = fb;\n      this.mainService = mainService;\n      this.data = data;\n      this._snackBar = _snackBar; // console.log(data);\n      // this.purchaseForm.patchValue(data);\n    }\n\n    ngOnInit() {\n      this.purchaseForm = new FormGroup({\n        bhada: new FormControl(Validators.required),\n        hammali: new FormControl(Validators.required),\n        cash: new FormControl(null, Validators.required),\n        commission_rate: new FormControl(null, Validators.required),\n        bhada_rate: new FormControl(null, Validators.required),\n        commission: new FormControl(Validators.required),\n        tax: new FormControl(null, Validators.required),\n        station_charge: new FormControl(null, Validators.required),\n        driver: new FormControl(null, Validators.required),\n        to_exp: new FormControl(null, Validators.required),\n        bill_total: new FormControl(null, Validators.required),\n        net_amount: new FormControl(null, Validators.required),\n        items: new FormArray([])\n      });\n      this.data.items.forEach(element => {\n        // this.purchaseForm.\n        const item = new FormGroup({\n          item_name: new FormControl(element.item_name, Validators.required),\n          bag: new FormControl(element.bag, Validators.required),\n          quantity: new FormControl(element.quantity, Validators.required),\n          rate: new FormControl(element.rate, Validators.required)\n        });\n        this.purchaseForm.get('items').push(item);\n      });\n      this.mainService.getConstants().then(data => {\n        this.taxRate = data.tax_rate;\n        this.hammaliRate = data.hammali_rate;\n      });\n      this.purchaseForm.patchValue(this.data);\n    }\n\n    save() {\n      console.log(this.purchaseForm.value);\n      this.mainService.editPurchase(this.purchaseForm.value, this.data._id).then(data => {\n        this._snackBar.open('Edit Saved', 'Close');\n      });\n    }\n\n    calculate() {\n      let objOne = this.purchaseForm.value;\n      let billTotal = 0;\n      let totalBag = 0;\n      this.data.items.forEach(element => {\n        billTotal = Number(billTotal) + Math.round(Number(element.quantity) * Number(element.rate));\n        totalBag = Number(totalBag) + Number(element.bag);\n      });\n      console.log(objOne.commission_rate, billTotal);\n      this.purchaseForm.patchValue({\n        hammali: Math.round(totalBag * this.hammaliRate),\n        bhada: Math.round(totalBag * objOne.bhada_rate),\n        tax: Math.round(totalBag * this.taxRate),\n        commission: Math.round(objOne.commission_rate / 100 * billTotal)\n      });\n      let total_exp = Math.round(totalBag * objOne.bhada_rate) + Math.round(objOne.commission_rate / 100 * billTotal) + objOne.driver + objOne.station_charge + Math.round(totalBag * this.hammaliRate) + Math.round(totalBag * this.taxRate) + objOne.cash;\n      this.purchaseForm.patchValue({\n        bill_total: billTotal,\n        to_exp: total_exp,\n        net_amount: billTotal - total_exp\n      });\n    }\n\n    removeItem(i) {\n      this.data.items.splice(i, 1);\n    }\n\n    arrayValChange(from, val, i) {\n      setTimeout(() => {\n        switch (from) {\n          case 'item':\n            this.data.items[i].item = val;\n            break;\n\n          case 'bag':\n            this.data.items[i].bag = val;\n            break;\n\n          case 'quantity':\n            this.data.items[i].quantity = val;\n            break;\n\n          case 'rate':\n            this.data.items[i].rate = val;\n            break;\n        }\n      }, 400);\n    }\n\n  }\n\n  PurchaseModelComponent.ɵfac = function PurchaseModelComponent_Factory(t) {\n    return new (t || PurchaseModelComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MainServiceService), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA), i0.ɵɵdirectiveInject(i3.MatSnackBar));\n  };\n\n  PurchaseModelComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PurchaseModelComponent,\n    selectors: [[\"app-purchase-model\"]],\n    decls: 93,\n    vars: 2,\n    consts: [[1, \"container\"], [3, \"formGroup\"], [1, \"row\"], [1, \"col\"], [1, \"form-floating\", \"mb-3\"], [\"formControlName\", \"driver\", \"type\", \"number\", 1, \"form-control\"], [\"for\", \"floatingInput\"], [\"formControlName\", \"cash\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"station_charge\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"tax\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"bhada\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"bhada_rate\", \"type\", \"text\", 1, \"form-control\"], [\"type\", \"text\", \"formControlName\", \"commission\", 1, \"form-control\"], [\"for\", \"floatingInputInvalid\"], [\"formControlName\", \"commission_rate\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"hammali\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"bill_total\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"to_exp\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"net_amount\", \"type\", \"number\", 1, \"form-control\"], [1, \"table\", 2, \"width\", \"100%\"], [\"table\", \"\"], [\"scope\", \"col\"], [\"formArrayName\", \"items\", 4, \"ngFor\", \"ngForOf\"], [1, \"btn\", \"btn-primary\", 3, \"click\"], [\"formArrayName\", \"items\"], [3, \"formGroupName\"], [\"scope\", \"row\"], [\"formControlName\", \"item_name\", 1, \"form-control\", 3, \"value\", \"input\"], [\"formControlName\", \"bag\", 1, \"form-control\", 3, \"value\", \"input\"], [\"type\", \"number\", \"formControlName\", \"quantity\", 1, \"form-control\", 3, \"value\", \"input\"], [\"type\", \"number\", \"formControlName\", \"rate\", 1, \"form-control\", 3, \"value\", \"input\"], [\"type\", \"number\", 1, \"form-control\", 3, \"value\"], [\"mat-mini-fab\", \"\", \"color\", \"primary\", \"type\", \"button\", 1, \"matButton\", 3, \"click\"], [1, \"material-icons\"]],\n    template: function PurchaseModelComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"form\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4);\n        i0.ɵɵelement(5, \"input\", 5);\n        i0.ɵɵelementStart(6, \"label\", 6);\n        i0.ɵɵtext(7, \"Driver\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(8, \"div\", 3)(9, \"div\", 4);\n        i0.ɵɵelement(10, \"input\", 7);\n        i0.ɵɵelementStart(11, \"label\", 6);\n        i0.ɵɵtext(12, \"Cash\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(13, \"div\", 3)(14, \"div\", 4);\n        i0.ɵɵelement(15, \"input\", 8);\n        i0.ɵɵelementStart(16, \"label\", 6);\n        i0.ɵɵtext(17, \"Station Charge\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(18, \"div\", 2)(19, \"div\", 3)(20, \"div\", 4);\n        i0.ɵɵelement(21, \"input\", 9);\n        i0.ɵɵelementStart(22, \"label\", 6);\n        i0.ɵɵtext(23, \"Tax\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(24, \"div\", 3)(25, \"div\", 4);\n        i0.ɵɵelement(26, \"input\", 10);\n        i0.ɵɵelementStart(27, \"label\", 6);\n        i0.ɵɵtext(28, \"Bhada\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(29, \"div\", 3)(30, \"div\", 4);\n        i0.ɵɵelement(31, \"input\", 11);\n        i0.ɵɵelementStart(32, \"label\", 6);\n        i0.ɵɵtext(33, \"Bhada Rate\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(34, \"div\", 2)(35, \"div\", 3)(36, \"div\", 4);\n        i0.ɵɵelement(37, \"input\", 12);\n        i0.ɵɵelementStart(38, \"label\", 13);\n        i0.ɵɵtext(39, \"Commission\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(40, \"div\", 3)(41, \"div\", 4);\n        i0.ɵɵelement(42, \"input\", 14);\n        i0.ɵɵelementStart(43, \"label\", 6);\n        i0.ɵɵtext(44, \"Commission Rate\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(45, \"div\", 3)(46, \"div\", 4);\n        i0.ɵɵelement(47, \"input\", 15);\n        i0.ɵɵelementStart(48, \"label\", 6);\n        i0.ɵɵtext(49, \"Hammali\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(50, \"div\", 2)(51, \"div\", 3)(52, \"div\", 4);\n        i0.ɵɵelement(53, \"input\", 16);\n        i0.ɵɵelementStart(54, \"label\", 6);\n        i0.ɵɵtext(55, \"Bill Total\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(56, \"div\", 3)(57, \"div\", 4);\n        i0.ɵɵelement(58, \"input\", 17);\n        i0.ɵɵelementStart(59, \"label\", 6);\n        i0.ɵɵtext(60, \"To Expense\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(61, \"div\", 3)(62, \"div\", 4);\n        i0.ɵɵelement(63, \"input\", 18);\n        i0.ɵɵelementStart(64, \"label\", 6);\n        i0.ɵɵtext(65, \"Net Amount\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(66, \"div\", 2)(67, \"table\", 19, 20)(69, \"thead\")(70, \"tr\")(71, \"th\", 21);\n        i0.ɵɵtext(72, \"#\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(73, \"th\", 21);\n        i0.ɵɵtext(74, \"ITEM\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(75, \"th\", 21);\n        i0.ɵɵtext(76, \"BAG\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(77, \"th\", 21);\n        i0.ɵɵtext(78, \"QUANTITY\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(79, \"th\", 21);\n        i0.ɵɵtext(80, \"RATE\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(81, \"th\", 21);\n        i0.ɵɵtext(82, \"AMOUNT\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(83, \"th\", 21);\n        i0.ɵɵtext(84, \"REMOVE\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(85, PurchaseModelComponent_tbody_85_Template, 18, 7, \"tbody\", 22);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(86, \"div\", 2)(87, \"button\", 23);\n        i0.ɵɵlistener(\"click\", function PurchaseModelComponent_Template_button_click_87_listener() {\n          return ctx.calculate();\n        });\n        i0.ɵɵtext(88, \"Calculate\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelement(89, \"hr\");\n        i0.ɵɵelementStart(90, \"div\", 2)(91, \"button\", 23);\n        i0.ɵɵlistener(\"click\", function PurchaseModelComponent_Template_button_click_91_listener() {\n          return ctx.save();\n        });\n        i0.ɵɵtext(92, \"Save the edit\");\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.purchaseForm);\n        i0.ɵɵadvance(84);\n        i0.ɵɵproperty(\"ngForOf\", ctx.data.items);\n      }\n    },\n    dependencies: [i4.NgForOf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i1.FormGroupName, i1.FormArrayName, i5.MatButton, i6.MatIcon]\n  });\n  return PurchaseModelComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}